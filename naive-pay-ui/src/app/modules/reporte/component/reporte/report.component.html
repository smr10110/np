<section>
    <div class="admin-toggle" style="display: flex; justify-content: flex-end; align-items: center;">
        <label class="switch">
            <input type="checkbox" [(ngModel)]="isAdminMode">
            <span class="slider"></span>
        </label>
        <span>{{ isAdminMode ? 'Administrador' : 'Usuario' }}</span>
    </div>

    <div class="tabs">
        <button [class.active]="activeTab === 'reports'" (click)="activeTab = 'reports'">Reportes</button>
        <button [class.active]="activeTab === 'analysis'" (click)="activeTab = 'analysis'">Análisis</button>
    </div>

    <div class="filters-grid" style="display: grid; grid-template-columns: repeat(4, minmax(160px, 1fr)); gap: 8px; margin: 8px 0; align-items: center;">        <label>Desde
            <input #from type="date" [value]="fromDate">
        </label>

        <label>Hasta
            <input #to type="date" [value]="toDate">
        </label>

        <label>Descripción
            <input #description type="text" placeholder="Ej., Comida, Viajes">
        </label>

        <label>Estado
            <select #status>
                @for (s of availableStatuses; track s) {
                    <option [value]="s">
                        {{ s === '' ? 'TODOS' : s }}
                    </option>
                }
            </select>
        </label>

        <label>Comercio
            <input #commerce type="text" placeholder="Nombre de comercio">
        </label>

        <label>Mín. Monto
            <input #min type="number" step="0.01">
        </label>

        <label>Máx. Monto
            <input #max type="number" step="0.01">
        </label>

        @if (isAdminMode) {
            <label>ID Usuario
                <input type="number" placeholder="ID Usuario" [(ngModel)]="userId" min="1">
            </label>
        }
    </div>

    <div class="actions" style="display: flex; justify-content: space-between; align-items: center; gap: 12px; margin-bottom: 16px;">
        <div style="flex:1; display:flex; justify-content:flex-start;">
            <button (click)="applyFilters(from.value, to.value, status.value, commerce.value, description.value, min.value, max.value, isAdminMode ? userId : undefined)">
                Aplicar Filtros
            </button>
        </div>
        <div style="flex:1; display:flex; justify-content:flex-end;">
            <button (click)="resetFilters(from, to, status, commerce, description, min, max)">
                Reiniciar Filtros
            </button>
        </div>
    </div>

    <div class="report-layout">
        @if (activeTab === 'reports') {
            <div>
                <app-report-table
                        [pagedTxs]="pagedTxs"
                        [filteredTxs]="filteredTxs"
                        [currentPage]="currentPage"
                        [totalPages]="totalPages"
                        [loading]="loading"
                        [error]="error"
                        (prevPage)="prevPage()"
                        (nextPage)="nextPage()"
                ></app-report-table>

                <div style="width:100%; display:flex; justify-content:center; margin:18px 0 0 0;">
                    <button class="export-csv" (click)="downloadCsv()">
                        Exportar a CSV
                    </button>
                </div>
            </div>
        }

        @if (activeTab === 'analysis') {
            <div>
                <app-analisis
                        [report]="report"
                        [avg]="avgMonthly.value"
                        [txs]="filteredTxs"
                        [loading]="loading"
                        [error]="error"
                ></app-analisis>
            </div>
        }
    </div>
</section>
