<div class="analysis-content">
    @if (loading) {
        <div>Cargando…</div>
    }
    @if (error) {
        <p style="color:red">Error: {{ error }}</p>
    }

    <!-- Monthly averages row -->
    <div class="averages-row">
        <!-- Monthly expenses average box -->
        <div class="average-card expenses-card">
            <span class="label">Promedio mensual de gastos</span>
            <span class="amount">{{ getMonthlyAverageExpenses() !== undefined ? (getMonthlyAverageExpenses() | number:'1.0-0') : 0 }}</span>
        </div>
        <!-- Monthly income average box -->
        <div class="average-card income-card">
            <span class="label">Promedio mensual de ingresos</span>
            <span class="amount">{{ getMonthlyAverageIncome() !== undefined ? (getMonthlyAverageIncome() | number:'1.0-0') : 0 }}</span>
        </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
        <button [class.active]="selectedTab === 'expenses'" (click)="setTab('expenses')">Gastos</button>
        <button [class.active]="selectedTab === 'income'" (click)="setTab('income')">Ingresos</button>
        <button [class.active]="selectedTab === 'total'" (click)="setTab('total')">Total</button>
    </div>

    <!-- Charts by tab with accordion -->
    @switch (selectedTab) {
        <!-- Expenses -->
        @case ('expenses') {
            <div>
                <div class="accordion">
                    <button class="accordion-btn" (click)="showCategory = !showCategory">
                        <span>Por Categoría</span>
                        <span>{{ showCategory ? '▲' : '▼' }}</span>
                    </button>
                    @if (showCategory) {
                        <div>
                            @if (categoryChartOptions) {
                                <apx-chart
                                        [series]="categoryChartOptions.series"
                                        [chart]="categoryChartOptions.chart"
                                        [xaxis]="categoryChartOptions.xaxis"
                                        [title]="categoryChartOptions.title"
                                        [dataLabels]="categoryChartOptions.dataLabels"
                                        [tooltip]="categoryChartOptions.tooltip">
                                </apx-chart>
                            }
                        </div>
                    }
                </div>
                <div class="accordion">
                    <button class="accordion-btn" (click)="showCommerce = !showCommerce">
                        <span>Por Comercio</span>
                        <span>{{ showCommerce ? '▲' : '▼' }}</span>
                    </button>
                    @if (showCommerce) {
                        <div>
                            @if (commerceChartOptions) {
                                <apx-chart
                                        [series]="commerceChartOptions.series"
                                        [chart]="commerceChartOptions.chart"
                                        [xaxis]="commerceChartOptions.xaxis"
                                        [title]="commerceChartOptions.title"
                                        [dataLabels]="commerceChartOptions.dataLabels"
                                        [tooltip]="commerceChartOptions.tooltip">
                                </apx-chart>
                            }
                        </div>
                    }
                </div>
                <div class="accordion">
                    <button class="accordion-btn" (click)="showDate = !showDate">
                        <span>Por Fecha</span>
                        <span>{{ showDate ? '▲' : '▼' }}</span>
                    </button>
                    @if (showDate) {
                        <div>
                            @if (dateChartOptions) {
                                <apx-chart
                                        [series]="dateChartOptions.series"
                                        [chart]="dateChartOptions.chart"
                                        [xaxis]="dateChartOptions.xaxis"
                                        [title]="dateChartOptions.title"
                                        [dataLabels]="dateChartOptions.dataLabels"
                                        [tooltip]="dateChartOptions.tooltip">
                                </apx-chart>
                            }
                        </div>
                    }
                </div>
            </div>
        }

        <!-- Income -->
        @case ('income') {
            <div>
                <div class="accordion">
                    <button class="accordion-btn" (click)="showCategory = !showCategory">
                        <span>Por Descripción</span>
                        <span>{{ showCategory ? '▲' : '▼' }}</span>
                    </button>
                    @if (showCategory) {
                        <div>
                            @if (categoryChartOptions) {
                                <apx-chart
                                        [series]="categoryChartOptions.series"
                                        [chart]="categoryChartOptions.chart"
                                        [xaxis]="categoryChartOptions.xaxis"
                                        [title]="categoryChartOptions.title"
                                        [dataLabels]="categoryChartOptions.dataLabels"
                                        [tooltip]="categoryChartOptions.tooltip">
                                </apx-chart>
                            }
                        </div>
                    }
                </div>
                <div class="accordion">
                    <button class="accordion-btn" (click)="showDate = !showDate">
                        <span>Por Fecha</span>
                        <span>{{ showDate ? '▲' : '▼' }}</span>
                    </button>
                    @if (showDate) {
                        <div>
                            @if (dateChartOptions) {
                                <apx-chart
                                        [series]="dateChartOptions.series"
                                        [chart]="dateChartOptions.chart"
                                        [xaxis]="dateChartOptions.xaxis"
                                        [title]="dateChartOptions.title"
                                        [dataLabels]="dateChartOptions.dataLabels"
                                        [tooltip]="dateChartOptions.tooltip">
                                </apx-chart>
                            }
                        </div>
                    }
                </div>
            </div>
        }

        <!-- Total -->
        @case ('total') {
            <div>
                <div class="accordion">
                    <button class="accordion-btn" (click)="showComparative = !showComparative">
                        <span>Comparativo Ingreso/Gasto</span>
                        <span>{{ showComparative ? '▲' : '▼' }}</span>
                    </button>
                    @if (showComparative) {
                        <div>
                            @if (comparativeChartOptions) {
                                <apx-chart
                                        [series]="comparativeChartOptions.series"
                                        [chart]="comparativeChartOptions.chart"
                                        [xaxis]="comparativeChartOptions.xaxis"
                                        [title]="comparativeChartOptions.title"
                                        [dataLabels]="comparativeChartOptions.dataLabels"
                                        [tooltip]="comparativeChartOptions.tooltip">
                                </apx-chart>
                            }
                        </div>
                    }
                </div>
            </div>
        }
    }
</div>
