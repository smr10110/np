<div class="auth-container">
    <div class="auth-card">
        <div class="card-header">
            <h2 class="card-title">
                <!-- Se crea un swtich, case, para ir cambiando de etpas a lo largo del registro -->
                @switch (currentStep) {
                    @case ('start') { <span>Crear Cuenta</span> }
                    @case ('verify') { <span>Verificar Email</span> }
                    @case ('complete') { <span>Completa tus Datos</span> }
                    @case ('setKey') { <span>Crear Clave Dinámica</span> }
                    @case ('success') { <span>¡Registro Exitoso!</span> }
                }
            </h2>
        </div>

        <div class="card-body">
            @if (currentStep === 'start') {
                <form [formGroup]="startForm" (ngSubmit)="onStartSubmit()">
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input id="email" type="email" formControlName="email" placeholder="tu@email.com">
                    </div>
                    <div class="form-group">
                        <label for="password">Contraseña</label>
                        <input id="password" type="password" formControlName="password" placeholder="Mínimo 8 caracteres">
                    </div>
                    <!-- no se activa el boton hasta que los validadores no son aceptados -->
                    <button type="submit" class="btn-primary" [disabled]="startForm.invalid || isLoading">
                        @if (isLoading) {
                            <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                            <span role="status">Cargando...</span>
                        } @else {
                            <span>Continuar</span>
                        }
                    </button>

                    <div class="mt-4 text-center">
                        <span class="text-sm text-gray-500">¿Ya tienes una cuenta?</span>
                        <a routerLink="/auth/login" class="ml-2 text-indigo-600 hover:underline font-medium">
                            Inicia sesión
                        </a>
                    </div>
                </form>
            }

            @if (currentStep === 'verify') {
                <div class="form-container">
                    <p class="text-center">Ingresa el código de 6 dígitos que enviamos a tu correo.</p>
                    <form [formGroup]="verifyForm" (ngSubmit)="onVerifySubmit()">
                        <div class="form-group">
                            <label>Código de Verificación</label>
                            <input type="text" formControlName="code" maxlength="6" placeholder="123456">
                        </div>
                        <button type="submit" class="btn-primary" [disabled]="verifyForm.invalid">Verificar</button>
                    </form>

                    <div class="resend-container">
                        <span>¿No recibiste el código? </span>
                        <button class="resend-button" (click)="resendVerificationCode()">Reenviar código</button>
                    </div>

                </div>
            }

            @if (currentStep === 'complete') {
                <form [formGroup]="completeForm" (ngSubmit)="onCompleteSubmit()">
                    <div class="form-group">
                        <label>Nombres</label>
                        <input type="text" formControlName="names">
                    </div>
                    <div class="form-group">
                        <label>Apellidos</label>
                        <input type="text" formControlName="lastNames">
                    </div>
                    <div class="form-group">
                        <label>RUT</label>
                        <div class="rut-group">
                            <input type="text" formControlName="rutGeneral" maxLength="8" placeholder="12345678"
                                   oninput="this.value = this.value.replace(/[^0-9]/g,'')">
                            <span>-</span>
                            <input type="text" formControlName="verificationDigit" maxLength="1" placeholder="K" class="rut-dv"
                                   oninput="this.value = this.value.toUpperCase().replace(/[^0-9K]/g, '')">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Fecha de Nacimiento</label>
                        <input type="date" formControlName="birthDate">
                    </div>

                    <div class="form-group">
                        <label>Teléfono</label>
                        <input type="text" formControlName="phoneNumber" maxlength="9" placeholder="9 12345678"
                               oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                    </div>
                    <div class="form-group">
                        <label>Profesión</label>
                        <input type="text" formControlName="profession">
                    </div>
                    <div class="form-group">
                        <label>Dirección</label>
                        <input type="text" formControlName="adress">
                    </div>
                    <button type="submit" class="btn-primary" [disabled]="completeForm.invalid">Finalizar Registro</button>
                </form>
            }

            @if (currentStep === 'setKey') {
                <form [formGroup]="setKeyForm" (ngSubmit)="onSetKeySubmit()">
                    <p class="text-center">Crea una clave de 6 dígitos para tus transacciones.</p>
                    <div class="form-group">
                        <label for="dynamicKey">Clave Dinámica</label>
                        <input id="dynamicKey" type="password" formControlName="dynamicKey" maxlength="6" placeholder="******">
                    </div>
                    <button type="submit" class="btn-primary" [disabled]="setKeyForm.invalid">Guardar Clave</button>
                </form>
            }

            @if (currentStep === 'success') {
                <div class="text-center">
                    <p>Tu cuenta ha sido creada correctamente. Ya puedes iniciar sesión.</p>
                    <a routerLink="/auth/login" class="btn-primary" style="margin-top: 1rem; display: inline-block">Iniciar Sesión</a>
                </div>
            }

            @if (errorMessage) {
                <div class="error-message">
                    {{ errorMessage }}
                </div>
            }
        </div>
    </div>
</div>
